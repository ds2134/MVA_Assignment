---
title: "Cluster Analysis"
author: "Deviprasad Saka"
date: "2024-03-07"
output: html_document
---

```{r}
library(MASS)
library(factoextra)
library(ggplot2)
library(readxl)
library(factoextra)
library(ggfortify)
library(ggrepel)
library(stats)

# Define the file path
file_path <- "D:/Multivariate Analysis/Datasets/Body Measurements _ original_CSV.csv"

# Read the CSV file
body <- read.csv(file_path)

# Standardized the data set excluding the first variable which is categorical
data.scaled <- scale(x = body[, -1], center = TRUE, scale = TRUE)
data <- data.scaled
head(data)
```


```{r}
# Extraction of components(eigen values)
e = eigen(cov(data))
print(e)
```

```{r}
# Variance of eigen values
e$values
```
```{r}
# Proportion of variances
e$values/12
```

```{r}
# Cumulative proportion
cumsum(e$values/12)
```

```{r}
# Data multiplied by eigen vectors to get the principal component vectors
# %*% = R operator for matrix multiplication of scaled data matrix
data.pc = as.matrix(data) %*% e$vectors
head(data.pc)
```

```{r}
# OR
# PCA using stats package

require(stats)
pc <- prcomp(data.scaled)
head(pc$x)
```

```{r}
summary(pc)
```

```{r}
# Define colors based on the first variable 
colors <- c(rep("blue", 100), rep("red", 100))  # Adjust as per your actual data

# Plot the first vs. second principal component
plot(x = pc$x[, 1], y = pc$x[, 2], 
     pch = c(rep(3, 100), rep(1, 100)), 
     col = c(rep("blue", 100), rep("red", 100)),
     xlab = "PC1", ylab = "PC2", main = "First vs. Second PC",
     cex.lab = 1.2, cex.axis = 1.2, cex.main = 1.8)
```

```{r}
# Perform PCA
pc <- prcomp(data.scaled)

# Extract the first three principal components
pc_first_three <- pc$x[, 1:3]

# Perform K-means clustering on the first three principal components
set.seed(123)  # For reproducibility
k <- 3  # Number of clusters
km_clusters <- kmeans(pc_first_three, centers = k)

# Plot the first three principal components with cluster assignments
plot(pc_first_three, col = km_clusters$cluster, 
     main = "First Three Principal Components with Cluster Assignments", 
     xlab = "PC1", ylab = "PC2", pch = 20)
```

```{r}

# Perform PCA
pc <- prcomp(data.scaled)

# Extract the first three principal components
pc_first_three <- pc$x[, 1:3]

# Take a subset of 20 rows
data_subset <- data[1:20, ]

# Perform PCA
pca_result <- prcomp(data_subset)

# Extract the first three principal components
pc_first_three <- pca_result$x[, 1:3]

# Perform hierarchical clustering on the first three principal components
hc <- hclust(dist(pc_first_three))

# Plot the dendrogram
plot(hc, main = "Dendrogram of Hierarchical Clustering (Subset of 20 Rows)",
     xlab = "Sample Index", ylab = "Distance", sub = NULL)
```

```{r}
library(magrittr)
library(NbClust)


# Define the file path
file_path <- "D:/Multivariate Analysis/Datasets/Body Measurements _ original_CSV.csv"

# Read the CSV file
body <- read.csv(file_path)

# Take a subset of 20 rows
body_subset <- body[1:20, c("ChestWidth", "ShoulderWidth", "Belly")]

# Calculate distance matrix
dist_matrix <- dist(body_subset)

# Hierarchical clustering
hclust_model <- hclust(dist_matrix)

# Plot the dendrogram
plot(hclust_model)
```


```{r}
num_clusters <- 3
clusters <- cutree(hclust_model, k = num_clusters)

# Membership for each cluster
table(km_clusters$cluster)
```
```{r}
# Visualize cluster and membership using first two Principal Components
fviz_cluster(list(data = pc$x[, 1:2], cluster = km_clusters$cluster))
```
```{r}
# Non-hierarchical clustering (k-means)
num_clusters <- 2  
kmeans_model <- kmeans(data, centers = num_clusters)

# Membership for each cluster
table(kmeans_model$cluster)
```
```{r}
# Visualize cluster and membership using first two Principal Components
fviz_cluster(list(data = pc$x[, 1:2], cluster = kmeans_model$cluster))
```
```{r}
# Load necessary libraries
library(cluster)
library(factoextra)
library(magrittr)
library(NbClust)
library(readxl)

# Define the file path
file_path <- "D:/Multivariate Analysis/Datasets/Body Measurements _ original_CSV.csv"

# Read the CSV file
body <- read.csv(file_path)

# Select numerical variables for clustering
data_num <- body[, c("ChestWidth", "ShoulderWidth", "Belly")]

# Perform hierarchical clustering
dist_matrix <- dist(data_num)
hclust_model <- hclust(dist_matrix)

# Decide on the optimal number of clusters based on the dendrogram
num_clusters_hclust <- 3  # Replace with chosen number of clusters

# Perform non-hierarchical clustering (k-means)
num_clusters_kmeans <- 2  # Replace with the chosen number of clusters
kmeans_model <- kmeans(data_num, centers = num_clusters_kmeans)

# Visualize cluster centers for k-means
fviz_cluster(kmeans_model, data = data_num, geom = "point", ellipse.type = "convex", 
             pointsize = 2, fill = "white", main = "K-means Cluster Centers")
```

```{r}
# Visualize cluster and membership using first two Principal Components for k-means
pca_result <- prcomp(data_num, scale = TRUE)
fviz_cluster(kmeans_model, data = pca_result$x[, 1:2], geom = "point", 
             pointsize = 2, fill = "white", main = "K-means Clustering Result (PCA)")
```

```{r}
# Calculate silhouette information for k-means clustering
sil <- silhouette(kmeans_model$cluster, dist(data_num))

# Visualize the silhouette plot for k-means clustering
fviz_silhouette(sil, main = "Silhouette Plot for K-means Clustering")
```

```{r}
# Create a data frame with cluster membership
data_clustered <- cbind(data_num, Cluster = kmeans_model$cluster)

# Scatter plot of data points colored by cluster membership
plot(data_clustered$ChestWidth, data_clustered$ShoulderWidth, 
     col = data_clustered$Cluster, pch = 16, 
     xlab = "Avg_Session_Duration", ylab = "Total_Sessions",
     main = "Scatter Plot of Clustering")
legend("topright", legend = unique(data_clustered$Cluster), 
       col = 1:num_clusters_kmeans, pch = 16, title = "Cluster")
```

